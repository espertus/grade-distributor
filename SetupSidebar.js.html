
<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script>

  $(document).ready(function() {  
    var status = $('#submit-status');
    status.hide();
    $('#create').prop('disabled', true);

    // https://stackoverflow.com/a/3321693/631051
    $('#validate').click(function(e) {
      e.preventDefault();
      validate();
      return true;
    });
  
    $('#create').click(function(e) {
      e.preventDefault();
      create();
      return true;
    });
  })


  function showError(message) {
    var status = $('#submit-status');
    status.addClass('error');
    status.text(message);
    status.show();
  }

  function showStatus(message) {
    var status = $('#submit-status');
    status.removeClass('error')
    status.text(message);
    status.show();
  }

  function validate() {
    this.disabled = true;
    google.script.run
      .withSuccessHandler(
        function(noErrors) {
          showStatus('Input looks good!');  
          $('#create').prop('disabled', false);
          $('#validate').prop('disabled', false);
        })
      .withFailureHandler(
          function(error) {
            showError(error);
            $('#validate').prop('disabled', false);
          })
      .validateStudentSetupSheet();
  }

  function create() {
    console.log('create');
    showStatus('create');
  }
  
  function onDistributeFormSubmit(event) {
    event.preventDefault();
    showMesssage('onDistributeFormSubmit');
    this.disabled = true;
    showStatus('Running...');

    var lhcol = $('#lhcol').val();
    var rhcol = $('#rhcol').val();
    var scol = $('#scol').val();
    var lrow = parseInt($('#lrow').val());

    if (!passesSanityCheck(lhcol, rhcol, scol, lrow)) {
      return;
    }

    showStatus("Starting to run...");
    var publicNotes = $('#public_notes').is(':checked');
    var studentNotes = $('#student_notes').is(':checked');
    google.script.run
      .withSuccessHandler(
        function(noErrors) {
          showStatus(noErrors ? 'Completed without errors.' : 'Completed with errors.');
        })
      .withFailureHandler(
        function(error) {
          showError('Error! ' + error);
        })
      .shareGrades(lhcol, rhcol, lrow, scol, publicNotes, studentNotes);
  }


</script>